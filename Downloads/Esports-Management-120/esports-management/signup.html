<!DOCTYPE html>
<html>
<head>
  <title>Signup</title>
  <link rel="stylesheet" type="text/css" href="css/signup.css">
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth-compat.js"></script>
  <script>
    // ðŸ”¹ Replace with your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDUFqfDlyZF_aA18Dc7ytirEja6E2rFCgQ",
      authDomain: "esports-62899.firebaseapp.com",
      databaseURL: "https://esports-62899-default-rtdb.firebaseio.com",
      projectId: "esports-62899",
      storageBucket: "esports-62899.appspot.com",
      messagingSenderId: "561025327999",
      appId: "1:561025327999:web:76a25a1f580903263ff04a",
      measurementId: "G-ZRLL1WY4D7"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
  </script>
</head>
<body>
  <form id="signupForm">
    <h2>Signup</h2> 

    <label>Email:</label><br>
    <input type="email" id="emailInput" required><br>

    <label>Password:</label><br>
    <input type="password" id="passwordInput" required><br>

  <label>Full Name:</label><br>
  <input type="text" id="fullNameInput" required><br>

    <label>Select Role:</label>
    <select id="roleSelect" required>
      <option value="admin">Admin</option>
      <option value="team_manager">Team Manager</option>
      <option value="player">Player</option>
      <option value="spectator">Spectator</option>
    </select>

    <button type="submit">Signup</button>
    <p>Already have an account? <a href="login.html">Login here</a></p>
  </form>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const signupForm = document.getElementById('signupForm');

      signupForm.addEventListener('submit', async function(e) {
        e.preventDefault();

        const email = document.getElementById('emailInput').value.trim();
        const password = document.getElementById('passwordInput').value.trim();
        const role = document.getElementById('roleSelect').value;

        try {
          // 1. Create user with Firebase Auth
          const userCredential = await auth.createUserWithEmailAndPassword(email, password);
          const idToken = await userCredential.user.getIdToken();

          // 2. Send role + token + fullName to backend
          const fullName = document.getElementById('fullNameInput').value.trim();
          const res = await fetch("http://localhost:3000/api/auth/sync-profile", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${idToken}`
            },
            body: JSON.stringify({ role, fullName })
          });

          const data = await res.json();
          console.log("Backend response:", data);

          // 3. Redirect based on role
          if (role === 'admin') window.location.href = 'admin_dashboard.html';
          else if (role === 'team_manager') window.location.href = 'manager_dashboard.html';
          else if (role === 'player') window.location.href = 'player_dashboard.html';
          else window.location.href = 'spectator_dashboard.html';

        } catch (err) {
          alert("Signup failed: " + err.message);
          console.error(err);
        }
      });

      // ðŸ”¹ Auto test CORS when page loads
      fetch("http://localhost:3000/test-cors")
        .then(r => r.json())
        .then(data => console.log("CORS test success:", data))
        .catch(err => console.error("CORS test failed:", err));
    });
  </script>
</body>
</html>
